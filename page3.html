<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mystery Restauranttt</title>
    <style>
        body { 
            font-family: 'Poppins', sans-serif; 
            margin: 0; 
            background: linear-gradient(180deg, #FF8A9D 0%, #FFC0CB 36%, #FFE6EA 100%);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            min-height: 100vh; color: #4a4a4a; overflow: hidden;
        }

        h1 { margin-bottom: 30px; text-transform: uppercase; letter-spacing: 4px; color: #fff; text-shadow: 2px 2px 4px rgba(0,0,0,0.1); }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px; width: 95%; max-width: 1200px;
            position: relative;
        }

        /* Chaotic Shuffle Animation */
        @keyframes chaoticShuffle {
            0% { transform: translate(0, 0) rotate(0deg); }
            25% { transform: translate(var(--tx), var(--ty)) rotate(180deg) scale(1.2); z-index: 50; }
            50% { transform: translate(calc(var(--tx) * -1), calc(var(--ty) * 0.5)) rotate(360deg) scale(0.8); z-index: 1; }
            75% { transform: translate(calc(var(--tx) * 0.5), calc(var(--ty) * -1)) rotate(540deg) scale(1.1); z-index: 50; }
            100% { transform: translate(0, 0) rotate(720deg); }
        }

        .shuffling-active { animation: chaoticShuffle 2s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards; }

        .card-container { height: 420px; perspective: 1200px; }

        .card-inner {
            position: relative; width: 100%; height: 100%;
            transition: transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
            transform-style: preserve-3d; cursor: pointer;
        }

        .flipped { transform: rotateY(180deg) !important; }

        .disabled { 
            opacity: 0.3; 
            pointer-events: none; 
            filter: blur(2px) grayscale(50%);
            transition: 1s;
        }

        .card-front, .card-back {
            position: absolute; width: 100%; height: 100%;
            backface-visibility: hidden; border-radius: 25px;
            display: flex; flex-direction: column; align-items: center;
            padding: 20px; box-sizing: border-box;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .card-front { 
            background: linear-gradient(135deg, #FF4B6E, #FF8A9D); 
            justify-content: center;
            border: 5px solid white;
        }
        
        .mystery-icon { font-size: 80px; color: white; }

        .card-back { 
            background: #ffffff; color: #4a4a4a; 
            transform: rotateY(180deg); 
            border: 4px solid #FF8A9D; 
            text-align: center;
        }

        .food-img { 
            width: 80%;            /* Smaller width to make it look "little bit small" */
            height: 150px; 
            object-fit: contain;   /* Ensures the "whole picture" is seen without cropping */
            border-radius: 20px;   /* Round edges */
            margin: 0 auto 15px auto; /* Centers the image horizontally */
            display: block;        /* Necessary for margin auto to work */
            background: #ffffff;   /* Clean white background for the image container */
            padding: 5px;          /* Adds some space so the logo doesn't touch the edges */
        }

        .food-title { margin: 5px 0; color: #FF4B6E; font-size: 1.4em; }
        .food-desc { font-size: 0.9em; color: #777; margin-bottom: 10px; line-height: 1.4; }

        .loader { width: 100%; height: 10px; background: #fff1f3; border-radius: 10px; overflow: hidden; margin-top: auto; }
        .progress { width: 0%; height: 100%; background: #FF4B6E; transition: width 5s linear; }
        .timer-text { font-weight: bold; color: #FF4B6E; font-size: 0.8em; margin-top: 8px; }

        .heart {
            position: fixed; color: #FF4B6E; font-size: 20px;
            user-select: none; pointer-events: none; z-index: 999;
            animation: heartBurst 5s ease-out forwards;
        }

        @keyframes heartBurst {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 1; }
            20% { transform: translate(calc(-50% + var(--vx)), calc(-50% + var(--vy))) scale(1.2) rotate(var(--rz)); opacity: 1;}
            100% { transform: translate(calc(-50% + var(--vx) * 1.5), calc(-50% + var(--vy) + 200px)) scale(0.5) rotate(calc(var(--rz) * 2)); opacity: 0;}
        }

        @media (max-width: 900px) {
            .grid-container { grid-template-columns: repeat(2, 1fr); }
            .card-container { height: 380px; }
        }
    </style>
</head>
<body>

    <h1 id="header-text">Mixing the options...</h1>

    <div class="grid-container" id="card-grid"></div>

    <script>
        const foodData = [
            { 
                name: 'Botejyu', 
                desc: 'Authentic Japanese traditional taste.', 
                img: 'https://d3up48wss6lvj.cloudfront.net/data/uploads/2020/07/BOTEJYU.png', 
                tx: '200%', ty: '100%' 
            },
            { 
                name: 'Pepper Lunch', 
                desc: 'Sizzle it your way!', 
                img: 'https://d3up48wss6lvj.cloudfront.net/uploads/tenants/logo/efea5dd410a5b4e6019c18fa90fedce3.png', 
                tx: '-150%', ty: '120%' 
            },
            { 
                name: 'Ramen Kuroda', 
                desc: 'Real Ramen for Everyone.', 
                img: 'https://d3up48wss6lvj.cloudfront.net/data/uploads/2020/07/RAMEN_KURODA.jpg', 
                tx: '100%', ty: '-150%' 
            },
            { 
                name: 'Wildcard Choice', 
                desc: 'Let’s find whatever restaurant suits our taste!', 
                img: 'https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400', 
                tx: '-200%', ty: '-120%' 
            }
        ];

        let isLocked = true;

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function createCards() {
            const grid = document.getElementById('card-grid');
            shuffleArray(foodData);

            foodData.forEach((food) => {
                const cardHtml = `
                    <div class="card-container" style="--tx: ${food.tx}; --ty: ${food.ty};">
                        <div class="card-inner" onclick="handleSelection(this, '${food.name}', '${food.desc}')">
                            <div class="card-front"><div class="mystery-icon">?</div></div>
                            <div class="card-back">
                                <img src="${food.img}" class="food-img">
                                <h2 class="food-title">${food.name}</h2>
                                <p class="food-desc">${food.desc}</p>
                                <div class="timer-text">REDIRECTING IN <span class="seconds">5</span>s</div>
                                <div class="loader"><div class="progress"></div></div>
                            </div>
                        </div>
                    </div>
                `;
                grid.innerHTML += cardHtml;
            });
        }

        window.onload = () => {
            createCards();
            const cards = document.querySelectorAll('.card-inner');
            cards.forEach((card, i) => {
                card.style.animationDelay = `${i * 0.1}s`;
                card.classList.add('shuffling-active');
            });

            setTimeout(() => {
                cards.forEach(card => card.classList.remove('shuffling-active'));
                document.getElementById('header-text').innerText = "Pick a Restaurant!";
                isLocked = false;
            }, 2500);
        };

        function spawnBurst(x, y) {
            for(let i = 0; i < 40; i++) {
                const heart = document.createElement('div');
                heart.classList.add('heart');
                heart.innerHTML = '❤️';
                const angle = Math.random() * Math.PI * 2;
                const distance = Math.random() * 200 + 50;
                const vx = Math.cos(angle) * distance + 'px';
                const vy = Math.sin(angle) * distance + 'px';
                const rz = Math.random() * 360 + 'deg';
                heart.style.left = x + 'px';
                heart.style.top = y + 'px';
                heart.style.setProperty('--vx', vx);
                heart.style.setProperty('--vy', vy);
                heart.style.setProperty('--rz', rz);
                document.body.appendChild(heart);
                setTimeout(() => heart.remove(), 5000);
            }
        }

        function handleSelection(element, itemName, itemDetail) {
            if (isLocked) return;
            isLocked = true; 
            const rect = element.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            element.classList.add('flipped');
            document.querySelectorAll('.card-inner').forEach(card => {
                if (card !== element) card.classList.add('disabled');
            });
            spawnBurst(centerX, centerY);
            const progressBar = element.querySelector('.progress');
            setTimeout(() => { progressBar.style.width = '100%'; }, 50);
            let timeLeft = 5;
            const display = element.querySelector('.seconds');
            const countdownInterval = setInterval(() => {
                timeLeft--;
                display.innerText = timeLeft; 
                if (timeLeft <= 0) {
                    clearInterval(countdownInterval);
                    localStorage.setItem('selectedFood', itemName);
                    localStorage.setItem('foodDetail', itemDetail);
                    // REDIRECT TO E-RECEIPT.HTML
                    window.location.href = 'e-receipt.html';
                }
            }, 1000);
        }
    </script>
</body>
</html>